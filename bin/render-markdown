#!/usr/bin/env bb

#_{:clj-kondo/ignore [:namespace-name-mismatch]}
(ns render-markdown
  (:require [babashka.fs :as fs])
  (:require [babashka.process :refer [shell]])
  (:require [clojure.string :as str]))

(let [shortsha (-> (shell {:out :string} "git rev-parse --short HEAD") :out)
      fullsha  (-> (shell {:out :string} "git rev-parse HEAD") :out)
      updated  (-> (shell {:out :string} "date +\"%d %b %Y\"") :out) ;; TODO replace with Java expr
      content  (slurp "resume.md")
      replaced (-> content
                   (str/replace "{shortsha}" shortsha)
                   (str/replace "{fullsha}" fullsha)
                   (str/replace "{updated}" updated))
      out-dir (fs/create-temp-dir {:prefix "resume"})
      out-file (fs/create-temp-file {:dir out-dir :prefix "resume" :suffix ".md"})]
  (spit (fs/file out-file) replaced)
  (println (str out-file)))
